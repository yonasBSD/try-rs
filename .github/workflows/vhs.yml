name: Generate GIF (VHS)

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:

jobs:
  vhs:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install System Dependencies
        # ADICIONADO: 'fish' (porque seu tape pede 'Set Shell fish')
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg chromium-browser libnss3 libxss1 libasound2 fish

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: 'stable'

      - name: Install VHS
        run: go install github.com/charmbracelet/vhs@latest

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Build try-rs
        run: cargo build --release

      - name: Run VHS
        run: |
          # Adiciona o binário ao PATH para o comando 'Require try-rs' funcionar
          export PATH="$PWD/target/release:$PATH"
          
          # Debug: Confirma que o try-rs e o fish estão acessíveis
          which try-rs
          which fish

          # Roda o VHS apontando para o arquivo na RAIZ (baseado no seu link)
          # Se o arquivo estiver numa pasta, mude para: vhs vhs/try-rs.tape
          vhs try-rs.tape

      - name: Attach GIF to Release
        uses: softprops/action-gh-release@v2
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: try-rs.gif
